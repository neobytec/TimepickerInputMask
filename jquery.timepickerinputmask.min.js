/**
 * TimepickerInputMask
 * 
 * @category   jquery
 * @package    plugin
 * @copyright  Víctor Bueno García 2012 neobytec@gmail.com http://www.neobytec.com
 * @license    MIT License (LICENSE.txt)
 * @version    1.0
 * 
 */
(function(a){a.fn.TimepickerInputMask=function(b){var c=null;var b=a.extend({seconds:true,spinners:false,separator:":",currentHour:null,bgcolor:"#fff",arrowColor:"#000"},b);var d=0,e=0,f=0;var g=2,h=0,i=b.seconds?2:1,j=false;var k={init:function(){c.bind("focus",k.events.focus);c.bind("blur",k.events.blur);c.bind("click",k.events.focus);c.bind("keydown",k.events.keyDown);c.bind("keyup",k.events.keyUp);a(document).bind("mousewheel",k.events.mousewheel);c.bind("drag drop",function(){return false});if(k.checkHour(c.val())){k.parseValue(c.val())}else{if(b.currentHour!="now"&&k.checkHour(b.currentHour)){k.parseValue(b.currentHour)}else{var g=new Date;d=g.getHours();e=g.getMinutes();f=g.getSeconds()}}if(b.spinners){k.initSpinners()}k.showValue()},events:{focus:function(a){j=true;h=0;a.preventDefault();if(!k.checkHour(c.val())){k.showValue()}k.setPosition(h)},blur:function(a){j=false},keyDown:function(a){if(a.keyCode>=48&&a.keyCode<=57||a.keyCode>=96&&a.keyCode<=105){g--}else if(a.keyCode==9){if(h!=i){a.preventDefault();k.setPosition(++h)}else{return true}}else{return false}},keyUp:function(a){if(g<=0){g=2;if(k.checkHour(c.val())){k.parseValue(c.val());if(h<i){h++}}else{k.showValue()}k.setPosition(h)}},mousewheel:function(a,b){if(j){var c=b==1?"up":"down";k.changeValue(c)}},clickSpinner:function(b){var c=a(b.currentTarget);var d=c.parent().attr("class");h=d=="hours"?0:d=="minutes"?1:2;k.changeValue(c.attr("class"))}},checkHour:function(a){if(a!=null&&a!=undefined){var c="^([0-1]{1}[0-9]{1}|2[0-3]{1})\\"+b.separator+"[0-5]{1}[0-9]{1}"+"(\\"+b.separator+"[0-5]{1}[0-9]{1})?$";var d=new RegExp(c);return a.match(d)}return false},parseValue:function(a){if(a.indexOf(b.separator)!=-1){var c=a.split(b.separator);d=parseInt(c[0],10);e=parseInt(c[1],10);f=c[2]!=undefined?parseInt(c[2],10):f}},showValue:function(a){var g="";g+=(d<10?"0"+d:d)+b.separator;g+=e<10?"0"+e:e;if(b.seconds){g+=b.separator+(f<10?"0"+f:f)}if(a){return g}c.val(g)},selectText:function(a,b){if(c.get(0).createTextRange){var d=c.get(0).createTextRange();d.collapse(true);d.moveStart("character",a);d.moveEnd("character",b);d.select()}else if(c.get(0).setSelectionRange){c.get(0).setSelectionRange(a,b)}else if(c.get(0).selectionStart){c.get(0).selectionStart=a;c.get(0).selectionEnd=b}},setPosition:function(a){var c=b.separator.length,d=2+c,e=d+(2+c);switch(a){case 0:default:h=0;k.selectText(0,2);break;case 1:h=a;k.selectText(d,d+2);break;case 2:h=a;k.selectText(e,e+2);break}},initSpinners:function(){b.separator=b.separator+b.separator+b.separator+b.separator;var d=c.position(),e=c.height(),f=c.width();var g=k.showValue(true),h=g.split(b.separator),i=k.getTextWidth(h[0]),j=i+k.getTextWidth(b.separator+h[1]),l=j+k.getTextWidth(b.separator+h[2]),m=k.getTextWidth(b.separator),n=parseInt(c.css("border-top-width").replace("px","")),o=parseInt(c.css("border-left-width").replace("px",""));var p=2*e/21,q=12*e/21,r=6*e/21,s=2*e/21;var t='<div class="TimepickerInputMask.spinners" style="position: absolute; background: transparent;"></div>',u='<div style="position: absolute;background: '+b.bgcolor+";height: 100%;width: "+m+'px;top: 0;"></span>',v='<a href="javascript:;" class="up" style="position: absolute;width: 0;height: 0;border-left: '+r+"px solid transparent;border-right: "+r+"px solid transparent;border-bottom: "+r+"px solid "+b.arrowColor+';"></a>',w='<a href="javascript:;" class="down" style="position: absolute;width: 0;height: 0;border-left: '+r+"px solid transparent;border-right: "+r+"px solid transparent;border-top: "+r+"px solid "+b.arrowColor+';"></a>';var x=a(t).appendTo(c.parent()).css({top:d.top+n,left:d.left+o,height:e+2});var y=a(u).appendTo(x).css({left:i}).addClass("hours");a(v).appendTo(y).css({top:p,left:s}).bind("click",k.events.clickSpinner);a(w).appendTo(y).css({top:q,left:s}).bind("click",k.events.clickSpinner);var z=a(u).appendTo(x).css({left:j}).addClass("minutes");a(v).appendTo(z).css({top:p,left:s}).bind("click",k.events.clickSpinner);a(w).appendTo(z).css({top:q,left:s}).bind("click",k.events.clickSpinner);if(b.seconds){var A=a(u).appendTo(x).css({left:l}).addClass("seconds");a(v).appendTo(A).css({top:p,left:s}).bind("click",k.events.clickSpinner);a(w).appendTo(A).css({top:q,left:s}).bind("click",k.events.clickSpinner)}},changeValue:function(a){switch(h){case 0:d=a=="up"?++d:--d;d=d>=24?0:d<0?23:d;break;case 1:e=a=="up"?++e:--e;e=e>=60?0:e<0?59:e;break;case 2:f=a=="up"?++f:--f;f=f>=60?0:f<0?59:f;break}k.showValue();k.setPosition(h)},getTextWidth:function(b){var d=a("<span>"+b+"</span>").appendTo(c.parent()).css({fontSize:c.css("font-size"),fontWeight:c.css("font-weight"),fontFamily:c.css("font-family")});var e=d.width();d.remove();return e}};return this.each(function(){c=a(this);k.init()})}})(jQuery)